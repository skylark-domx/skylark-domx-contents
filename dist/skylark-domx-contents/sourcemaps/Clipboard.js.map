{"version":3,"sources":["Clipboard.js"],"names":["define","langx","$","contents","Clipboard","Evented","inherit","pluginName","prototype","opts","pasteImage","cleanPaste","init","editor","_this","this","extend","body","on","e","range","pasting","_pasteBin","triggerHandler","selection","deleteRangeContents","html","collapsed","collapse","formatter","format","setRangeAtStartOf","find","_processPasteByClipboardApi","inputManager","throttledValueChanged","clear","throttledSelectionChanged","undoManager","throttledPushState","reset","resetCaretPosition","_getPasteContent","pasteContent","_processPasteContent","_pasteInBlockEl","_pastePlainText","imageFile","pasteItem","ref","uploadOpt","util","browser","edge","originalEvent","clipboardData","items","length","test","type","getAsFile","name","uploader","upload","callback","state","addClass","classPrefix","attr","appendTo","el","caret","caretPosition","focus","setTimeout","hidePopover","get","innerHTML","blockNodes","last","is","clearHtml","append","remove","_cleanPasteFontSize","decorate","beautify","children","$blockEl","$img","blob","dataURLtoBlob","img","insertPosition","k","l","lastLine","len","len1","len2","len3","len4","line","lines","m","node","o","q","ref1","ref2","split","pop","insertNode","document","createTextNode","text","css","RegExp","location","origin","Image","onload","canvas","createElement","width","naturalWidth","height","naturalHeight","getContext","drawImage","toDataURL","src","isEmptyNode","replaceWith","setRangeAtEndOf","parent","after","rangeAtStartOf","rangeAtEndOf","breakBlockEl","$node","sizeMap","map","i","$el","inArray"],"mappings":"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","file":"../Clipboard.js","sourcesContent":["define([\r\n  \"skylark-langx/langx\",\r\n  \"skylark-utils-dom/query\",\r\n  \"./contents\"\r\n],function(langx,$,contents){ \r\n\r\n  var Clipboard = langx.Evented.inherit({\r\n\r\n  });\r\n\r\n\r\n  Clipboard.pluginName = 'Clipboard';\r\n\r\n  Clipboard.prototype.opts = {\r\n    pasteImage: false,\r\n    cleanPaste: false\r\n  };\r\n\r\n  Clipboard.prototype.init = function(editor,opts) {\r\n    this.editor = editor; //this._module;\r\n    this.opts = langx.extend({}, this.opts, opts);\r\n    if (this.opts.pasteImage && typeof this.opts.pasteImage !== 'string') {\r\n      this.opts.pasteImage = 'inline';\r\n    }\r\n    this.editor.body.on('paste', (function(_this) {\r\n      return function(e) {\r\n        var range;\r\n        if (_this.pasting || _this._pasteBin) {\r\n          return;\r\n        }\r\n        if (_this.editor.triggerHandler(e) === false) {\r\n          return false;\r\n        }\r\n        range = _this.editor.selection.deleteRangeContents();\r\n        if (_this.editor.body.html()) {\r\n          if (!range.collapsed) {\r\n            range.collapse(true);\r\n          }\r\n        } else {\r\n          _this.editor.formatter.format();\r\n          _this.editor.selection.setRangeAtStartOf(_this.editor.body.find('p:first'));\r\n        }\r\n        if (_this._processPasteByClipboardApi(e)) {\r\n          return false;\r\n        }\r\n        _this.editor.inputManager.throttledValueChanged.clear();\r\n        _this.editor.inputManager.throttledSelectionChanged.clear();\r\n        _this.editor.undoManager.throttledPushState.clear();\r\n        _this.editor.selection.reset();\r\n        _this.editor.undoManager.resetCaretPosition();\r\n        _this.pasting = true;\r\n        return _this._getPasteContent(function(pasteContent) {\r\n          _this._processPasteContent(pasteContent);\r\n          _this._pasteInBlockEl = null;\r\n          _this._pastePlainText = null;\r\n          return _this.pasting = false;\r\n        });\r\n      };\r\n    })(this));\r\n  };\r\n\r\n  Clipboard.prototype._processPasteByClipboardApi = function(e) {\r\n    var imageFile, pasteItem, ref, uploadOpt;\r\n    if (this.editor.util.browser.edge) {\r\n      return;\r\n    }\r\n    if (e.originalEvent.clipboardData && e.originalEvent.clipboardData.items && e.originalEvent.clipboardData.items.length > 0) {\r\n      pasteItem = e.originalEvent.clipboardData.items[0];\r\n      if (/^image\\//.test(pasteItem.type)) {\r\n        imageFile = pasteItem.getAsFile();\r\n        if (!((imageFile != null) && this.opts.pasteImage)) {\r\n          return;\r\n        }\r\n        if (!imageFile.name) {\r\n          imageFile.name = \"Clipboard Image.png\";\r\n        }\r\n        if (this.editor.triggerHandler('pasting', [imageFile]) === false) {\r\n          return;\r\n        }\r\n        uploadOpt = {};\r\n        uploadOpt[this.opts.pasteImage] = true;\r\n        if ((ref = this.editor.uploader) != null) {\r\n          ref.upload(imageFile, uploadOpt);\r\n        }\r\n        return true;\r\n      }\r\n    }\r\n  };\r\n\r\n  Clipboard.prototype._getPasteContent = function(callback) {\r\n    var state;\r\n    this._pasteBin = $('<div contenteditable=\"true\" />').addClass(this.opts.classPrefix + 'paste-bin').attr('tabIndex', '-1').appendTo(this.editor.el);\r\n    state = {\r\n      html: this.editor.body.html(),\r\n      caret: this.editor.undoManager.caretPosition()\r\n    };\r\n    this._pasteBin.focus();\r\n    return setTimeout((function(_this) {\r\n      return function() {\r\n        var pasteContent;\r\n        _this.editor.hidePopover();\r\n        _this.editor.body.get(0).innerHTML = state.html;\r\n        _this.editor.undoManager.caretPosition(state.caret);\r\n        _this.editor.body.focus();\r\n        _this.editor.selection.reset();\r\n        _this.editor.selection.range();\r\n        _this._pasteInBlockEl = _this.editor.selection.blockNodes().last();\r\n        _this._pastePlainText = _this.opts.cleanPaste || _this._pasteInBlockEl.is('pre, table');\r\n        if (_this._pastePlainText) {\r\n          pasteContent = _this.editor.formatter.clearHtml(_this._pasteBin.html(), true);\r\n        } else {\r\n          pasteContent = $('<div/>').append(_this._pasteBin.contents());\r\n          pasteContent.find('style').remove();\r\n          pasteContent.find('table colgroup').remove();\r\n          _this._cleanPasteFontSize(pasteContent);\r\n          _this.editor.formatter.format(pasteContent);\r\n          _this.editor.formatter.decorate(pasteContent);\r\n          _this.editor.formatter.beautify(pasteContent.children());\r\n          pasteContent = pasteContent.contents();\r\n        }\r\n        _this._pasteBin.remove();\r\n        _this._pasteBin = null;\r\n        return callback(pasteContent);\r\n      };\r\n    })(this), 0);\r\n  };\r\n\r\n  Clipboard.prototype._processPasteContent = function(pasteContent) {\r\n    var $blockEl, $img, blob, children, dataURLtoBlob, img, insertPosition, k, l, lastLine, len, len1, len2, len3, len4, line, lines, m, node, o, q, ref, ref1, ref2, uploadOpt, uploader;\r\n    if (this.editor.triggerHandler('pasting', [pasteContent]) === false) {\r\n      return;\r\n    }\r\n    $blockEl = this._pasteInBlockEl;\r\n    if (!pasteContent) {\r\n      return;\r\n    }\r\n    if (this._pastePlainText) {\r\n      if ($blockEl.is('table')) {\r\n        lines = pasteContent.split('\\n');\r\n        lastLine = lines.pop();\r\n        for (k = 0, len = lines.length; k < len; k++) {\r\n          line = lines[k];\r\n          this.editor.selection.insertNode(document.createTextNode(line));\r\n          this.editor.selection.insertNode($('<br/>'));\r\n        }\r\n        this.editor.selection.insertNode(document.createTextNode(lastLine));\r\n      } else {\r\n        pasteContent = $('<div/>').text(pasteContent);\r\n        ref = pasteContent.contents();\r\n        for (l = 0, len1 = ref.length; l < len1; l++) {\r\n          node = ref[l];\r\n          this.editor.selection.insertNode($(node)[0]);\r\n        }\r\n      }\r\n    } else if ($blockEl.is(this.editor.body)) {\r\n      for (m = 0, len2 = pasteContent.length; m < len2; m++) {\r\n        node = pasteContent[m];\r\n        this.editor.selection.insertNode(node);\r\n      }\r\n    } else if (pasteContent.length < 1) {\r\n      return;\r\n    } else if (pasteContent.length === 1) {\r\n      if (pasteContent.is('p')) {\r\n        children = pasteContent.contents();\r\n        if ($blockEl.is('h1, h2, h3, h4, h5')) {\r\n          if (children.length) {\r\n            children.css('font-size', '');\r\n          }\r\n        }\r\n        if (children.length === 1 && children.is('img')) {\r\n          $img = children;\r\n          if (/^data:image/.test($img.attr('src'))) {\r\n            if (!this.opts.pasteImage) {\r\n              return;\r\n            }\r\n            blob = this.editor.util.dataURLtoBlob($img.attr(\"src\"));\r\n            blob.name = \"Clipboard Image.png\";\r\n            uploadOpt = {};\r\n            uploadOpt[this.opts.pasteImage] = true;\r\n            if ((ref1 = this.editor.uploader) != null) {\r\n              ref1.upload(blob, uploadOpt);\r\n            }\r\n            return;\r\n          } else if (new RegExp('^blob:' + location.origin + '/').test($img.attr('src'))) {\r\n            if (!this.opts.pasteImage) {\r\n              return;\r\n            }\r\n            uploadOpt = {};\r\n            uploadOpt[this.opts.pasteImage] = true;\r\n            dataURLtoBlob = this.editor.util.dataURLtoBlob;\r\n            uploader = this.editor.uploader;\r\n            img = new Image;\r\n            img.onload = function() {\r\n              var canvas;\r\n              canvas = document.createElement('canvas');\r\n              canvas.width = img.naturalWidth;\r\n              canvas.height = img.naturalHeight;\r\n              canvas.getContext('2d').drawImage(img, 0, 0);\r\n              blob = dataURLtoBlob(canvas.toDataURL('image/png'));\r\n              blob.name = 'Clipboard Image.png';\r\n              if (uploader !== null) {\r\n                uploader.upload(blob, uploadOpt);\r\n              }\r\n            };\r\n            img.src = $img.attr('src');\r\n            return;\r\n          } else if ($img.is('img[src^=\"webkit-fake-url://\"]')) {\r\n            return;\r\n          }\r\n        }\r\n        for (o = 0, len3 = children.length; o < len3; o++) {\r\n          node = children[o];\r\n          this.editor.selection.insertNode(node);\r\n        }\r\n      } else if ($blockEl.is('p') && this.editor.util.isEmptyNode($blockEl)) {\r\n        $blockEl.replaceWith(pasteContent);\r\n        this.editor.selection.setRangeAtEndOf(pasteContent);\r\n      } else if (pasteContent.is('ul, ol')) {\r\n        if (pasteContent.find('li').length === 1) {\r\n          pasteContent = $('<div/>').text(pasteContent.text());\r\n          ref2 = pasteContent.contents();\r\n          for (q = 0, len4 = ref2.length; q < len4; q++) {\r\n            node = ref2[q];\r\n            this.editor.selection.insertNode($(node)[0]);\r\n          }\r\n        } else if ($blockEl.is('li')) {\r\n          $blockEl.parent().after(pasteContent);\r\n          this.editor.selection.setRangeAtEndOf(pasteContent);\r\n        } else {\r\n          $blockEl.after(pasteContent);\r\n          this.editor.selection.setRangeAtEndOf(pasteContent);\r\n        }\r\n      } else {\r\n        $blockEl.after(pasteContent);\r\n        this.editor.selection.setRangeAtEndOf(pasteContent);\r\n      }\r\n    } else {\r\n      if ($blockEl.is('li')) {\r\n        $blockEl = $blockEl.parent();\r\n      }\r\n      if (this.editor.selection.rangeAtStartOf($blockEl)) {\r\n        insertPosition = 'before';\r\n      } else if (this.editor.selection.rangeAtEndOf($blockEl)) {\r\n        insertPosition = 'after';\r\n      } else {\r\n        this.editor.selection.breakBlockEl($blockEl);\r\n        insertPosition = 'before';\r\n      }\r\n      $blockEl[insertPosition](pasteContent);\r\n      this.editor.selection.setRangeAtEndOf(pasteContent.last());\r\n    }\r\n    return this.editor.inputManager.throttledValueChanged();\r\n  };\r\n\r\n  Clipboard.prototype._cleanPasteFontSize = function(node) {\r\n    var $node, sizeMap;\r\n    $node = $(node);\r\n    if (!($node.length > 0)) {\r\n      return;\r\n    }\r\n    sizeMap = ['1.5em', '1.25em', '0.75em', '0.5em'];\r\n    return $node.find('[style*=\"font-size\"]').map(function(i, el) {\r\n      var $el;\r\n      $el = $(el);\r\n      if (langx.inArray($el.css('font-size'), sizeMap) < 0) {\r\n        return $el.css('font-size', '');\r\n      }\r\n    });\r\n  };\r\n\r\n  return contents.Clipboard = Clipboard;\r\n\r\n});\r\n\r\n"]}