{"version":3,"sources":["editable.js"],"names":["define","langx","noder","$","contents","hotkeys","Util","InputManager","Selection","UndoManager","Keystroke","Formatter","Indentation","Clipboard","Editor","Evented","inherit","init","el","opts","this","textarea","body","pluginOpts","classPrefix","util","Error","inputManager","selection","undoManager","keystroke","formatter","indentation","clipboard","os","mac","addClass","linux","mobile","browser","mozilla","reflow","document","execCommand","_error","e","setValue","val","get","innerHTML","format","decorate","lastCaretPosition","getValue","sync","children","cloneBody","emptyP","firstP","lastP","clone","undecorate","autolink","last","first","is","isEmptyNode","prev","remove","next","find","trim","html","focus","$blockEl","range","caretPosition","append","phBr","appendTo","createRange","setRangeAtEndOf","blur","isActive","state","queryCommandState","status","cmd","htmlTag","nodes","filter","length","css","alignment","align","text-align","trigger","throttledSelectionChanged","blockquote","disableTag","$rootNodes","clearCache","nodeCache","_this","rootNodes","i","node","parent","save","insertBefore","each","$node","unwrap","isDecoratedNode","push","restore","blockCode","resultNodes","$pre","text","clearHtml","$p","replace","replaceAll","fontColor","hex","isDefault","coloredText","collapsed","textNode","createTextNode","insertNode","selectNodeContents","support","oninput","fontScale","param","sizeMap","containerNode","x-large","large","small","x-small","reset","nodeType","Node","TEXT_NODE","closest","n","$span","size","style","fontSize","test","replaceWith","hr","$hr","$newBlock","$rootBlock","insertAfter","setRangeAtStartOf","inlineCode","active","$code","$contents","extractContents","indent","link","defaultLinkText","$link","linkText","txtNode","startNodes","selectNode","href","target","blockNodes","list","type","$list","anotherType","contains","li","outdent","title","forEach","prototype","editable"],"mappings":"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","file":"../editable.js","sourcesContent":["define([\r\n\t\"skylark-langx/langx\",\r\n\t\"skylark-utils-dom/noder\",\r\n\t\"skylark-utils-dom/query\",\r\n\t\"./contents\",\r\n\t\"./hotkeys\",\r\n\t\"./Util\",\r\n\t\"./InputManager\", \r\n\t\"./Selection\", \r\n\t\"./UndoManager\", \r\n\t\"./Keystroke\",\r\n\t\"./Formatter\", \r\n\t\"./Indentation\", \r\n\t\"./Clipboard\"\r\n],function(langx, noder, $, contents,hotkeys,Util,InputManager,Selection,UndoManager,Keystroke,Formatter,Indentation,Clipboard){\r\n  var Editor = langx.Evented.inherit({\r\n    init : function(el,opts) {\r\n    \tthis.el = el;\r\n    \tthis.textarea = $(opts.textarea);\r\n    \tthis.body = $(opts.body);\r\n\r\n    \tvar pluginOpts = {\r\n    \t\tclassPrefix : opts.classPrefix\r\n    \t};\r\n\r\n      this.util = new Util(this,pluginOpts);\r\n\r\n      if (hotkeys) {\r\n        this.hotkeys = hotkeys({\r\n          el: this.body\r\n        });\r\n      } else {\r\n        throw new Error('simditor: simple-hotkeys is required.');\r\n        return;\r\n      }\r\n      this.inputManager = new InputManager(this,pluginOpts);\r\n      this.selection = new Selection(this,pluginOpts);\r\n      this.undoManager = new UndoManager(this,pluginOpts);\r\n      this.keystroke = new Keystroke(this,pluginOpts);\r\n      this.formatter = new Formatter(this,pluginOpts);\r\n      this.indentation = new Indentation(this,pluginOpts);\r\n      this.clipboard = new Clipboard(this,pluginOpts);\r\n\r\n\t\tif (this.util.os.mac) {\r\n\t\t  this.el.addClass(opts.classPrefix + 'mac');\r\n\t\t} else if (this.util.os.linux) {\r\n\t\t  this.el.addClass(opts.classPrefix + 'linux');\r\n\t\t}\r\n\t\tif (this.util.os.mobile) {\r\n\t\t  this.el.addClass(opts.classPrefix + 'mobile');\r\n\t\t}\r\n\r\n      if (this.util.browser.mozilla) {\r\n        this.util.reflow();\r\n        try {\r\n          document.execCommand('enableObjectResizing', false, false);\r\n          return document.execCommand('enableInlineTableEditing', false, false);\r\n        } catch (_error) {\r\n          e = _error;\r\n        }\r\n      }\r\n\r\n    },\r\n\r\n\tsetValue : function(val) {\r\n\t\tthis.textarea.val(val);\r\n\t\tthis.body.get(0).innerHTML = val;\r\n\t\tthis.formatter.format();\r\n\t\tthis.formatter.decorate();\r\n\t\tthis.util.reflow(this.body);\r\n\t\tthis.inputManager.lastCaretPosition = null;\r\n\t},\r\n\r\n\tgetValue : function() {\r\n\t\treturn this.sync();\r\n\t},\r\n\r\n\tsync : function() {\r\n\t\tvar children, cloneBody, emptyP, firstP, lastP, val;\r\n\t\tcloneBody = this.body.clone();\r\n\t\tthis.formatter.undecorate(cloneBody);\r\n\t\tthis.formatter.format(cloneBody);\r\n\t\tthis.formatter.autolink(cloneBody);\r\n\t\tchildren = cloneBody.children();\r\n\t\tlastP = children.last('p');\r\n\t\tfirstP = children.first('p');\r\n\t\twhile (lastP.is('p') && this.util.isEmptyNode(lastP)) {\r\n\t\t  emptyP = lastP;\r\n\t\t  lastP = lastP.prev('p');\r\n\t\t  emptyP.remove();\r\n\t\t}\r\n\t\twhile (firstP.is('p') && this.util.isEmptyNode(firstP)) {\r\n\t\t  emptyP = firstP;\r\n\t\t  firstP = lastP.next('p');\r\n\t\t  emptyP.remove();\r\n\t\t}\r\n\t\tcloneBody.find('img.uploading').remove();\r\n\t\tval = langx.trim(cloneBody.html());\r\n\t\tthis.textarea.val(val);\r\n\t\treturn val;\r\n\t},\r\n\r\n\tfocus : function() {\r\n\t\tvar $blockEl, range;\r\n\t\tif (!(this.body.is(':visible') && this.body.is('[contenteditable]'))) {\r\n\t\t  this.el.find('textarea:visible').focus();\r\n\t\t  return;\r\n\t\t}\r\n\t\tif (this.inputManager.lastCaretPosition) {\r\n\t\t  this.undoManager.caretPosition(this.inputManager.lastCaretPosition);\r\n\t\t  return this.inputManager.lastCaretPosition = null;\r\n\t\t} else {\r\n\t\t  $blockEl = this.body.children().last();\r\n\t\t  if (!$blockEl.is('p')) {\r\n\t\t    $blockEl = $('<p/>').append(this.util.phBr).appendTo(this.body);\r\n\t\t  }\r\n\t\t  range = document.createRange();\r\n\t\t  return this.selection.setRangeAtEndOf($blockEl, range);\r\n\t\t}\r\n\t},\r\n\r\n\tblur : function() {\r\n\t\tif (this.body.is(':visible') && this.body.is('[contenteditable]')) {\r\n\t\t  return this.body.blur();\r\n\t\t} else {\r\n\t\t  return this.body.find('textarea:visible').blur();\r\n\t\t}\r\n\t},\r\n\r\n\tisActive : function(state) {\r\n\t\treturn document.queryCommandState(state) === true; //'bold'\r\n\t},\r\n\r\n\tstatus : function(cmd,htmlTag) {\r\n\t\tif (cmd === \"alignment\") {\r\n\t\t    var nodes = this.selection.nodes().filter(htmlTag);\r\n\t\t    if (nodes.length < 1) {\r\n\t\t    \treturn null;\r\n\t\t    } else {\r\n\t\t      return nodes.first().css('text-align');\r\n\t\t    }\r\n\r\n\t\t}\r\n\t},\r\n\r\n\talignment : function(align,htmlTag) {\r\n\t    if (align !== 'left' && align !== 'center' && align !== 'right') {\r\n\t      throw new Error(\"simditor alignment button: invalid align \" + align);\r\n\t    }\r\n    \tvar nodes = this.selection.nodes().filter(htmlTag);\r\n\t    nodes.css({\r\n\t      'text-align': align === 'left' ? '' : align\r\n\t    });\r\n\t    this.trigger('valuechanged');\r\n\t    return this.inputManager.throttledSelectionChanged();\r\n\r\n\t},\r\n\r\n\tblockquote : function(htmlTag,disableTag) {\r\n\t    var $rootNodes, clearCache, nodeCache;\r\n\t    $rootNodes = this.selection.rootNodes();\r\n\t    $rootNodes = $rootNodes.filter(function(i, node) {\r\n\t      return !$(node).parent().is('blockquote');\r\n\t    });\r\n\t    this.selection.save();\r\n\t    nodeCache = [];\r\n\t    clearCache = (function(_this) {\r\n\t      return function() {\r\n\t        if (nodeCache.length > 0) {\r\n\t          $(\"<\" + _this.htmlTag + \"/>\").insertBefore(nodeCache[0]).append(nodeCache);\r\n\t          return nodeCache.length = 0;\r\n\t        }\r\n\t      };\r\n\t    })(this);\r\n\t    $rootNodes.each((function(_this) {\r\n\t      return function(i, node) {\r\n\t        var $node;\r\n\t        $node = $(node);\r\n\t        if (!$node.parent().is(_this.body)) {\r\n\t          return;\r\n\t        }\r\n\t        if ($node.is(htmlTag)) {\r\n\t          clearCache();\r\n\t          return $node.children().unwrap();\r\n\t        } else if ($node.is(disableTag) || _this.util.isDecoratedNode($node)) {\r\n\t          return clearCache();\r\n\t        } else {\r\n\t          return nodeCache.push(node);\r\n\t        }\r\n\t      };\r\n\t    })(this));\r\n\t    clearCache();\r\n\t    this.selection.restore();\r\n\t    return this.trigger('valuechanged');\r\n\r\n\t},\r\n\r\n\tblockCode : function(htmlTag,disableTag) {\r\n\t    var $rootNodes, clearCache, nodeCache, resultNodes;\r\n\t    $rootNodes = this.selection.rootNodes();\r\n\t    nodeCache = [];\r\n\t    resultNodes = [];\r\n\t    clearCache = (function(_this) {\r\n\t      return function() {\r\n\t        var $pre;\r\n\t        if (!(nodeCache.length > 0)) {\r\n\t          return;\r\n\t        }\r\n\t        $pre = $(\"<\" + htmlTag + \"/>\").insertBefore(nodeCache[0]).text(_this.formatter.clearHtml(nodeCache));\r\n\t        resultNodes.push($pre[0]);\r\n\t        return nodeCache.length = 0;\r\n\t      };\r\n\t    })(this);\r\n\t    $rootNodes.each((function(_this) {\r\n\t      return function(i, node) {\r\n\t        var $node, $p;\r\n\t        $node = $(node);\r\n\t        if ($node.is(htmlTag)) {\r\n\t          clearCache();\r\n\t          $p = $('<p/>').append($node.html().replace('\\n', '<br/>')).replaceAll($node);\r\n\t          return resultNodes.push($p[0]);\r\n\t        } else if ($node.is(disableTag) || _this.util.isDecoratedNode($node) || $node.is('blockquote')) {\r\n\t          return clearCache();\r\n\t        } else {\r\n\t          return nodeCache.push(node);\r\n\t        }\r\n\t      };\r\n\t    })(this));\r\n\t    clearCache();\r\n\t    this.selection.setRangeAtEndOf($(resultNodes).last());\r\n\t    return this.trigger('valuechanged');\r\n\r\n\t},\r\n\r\n\tfontColor : function(hex,isDefault,coloredText) {\r\n        var range = this.selection.range();\r\n        if (!isDefault && range.collapsed) {\r\n          textNode = document.createTextNode(coloredText);\r\n          range.insertNode(textNode);\r\n          range.selectNodeContents(textNode);\r\n        }\r\n        this.selection.range(range);\r\n        document.execCommand('styleWithCSS', false, true);\r\n        document.execCommand('foreColor', false, hex);\r\n        document.execCommand('styleWithCSS', false, false);\r\n        if (!this.util.support.oninput) {\r\n          return this.trigger('valuechanged');\r\n        }\r\n\r\n\t},\r\n\r\n\tfontScale : function(param,sizeMap) {\r\n  \t\tif (!sizeMap){\r\n  \t\t\tsizeMap = {\r\n\t\t\t    'x-large': '1.5em',\r\n\t\t\t    'large': '1.25em',\r\n\t\t\t    'small': '.75em',\r\n\t\t\t    'x-small': '.5em'\r\n\t\t   };\r\n\t\t}\r\n\r\n\t    var $scales, containerNode, range;\r\n\t    range = this.selection.range();\r\n\t    if (range.collapsed) {\r\n\t      return;\r\n\t    }\r\n\t    this.selection.range(range);\r\n\t    document.execCommand('styleWithCSS', false, true);\r\n\t    document.execCommand('fontSize', false, param);\r\n\t    document.execCommand('styleWithCSS', false, false);\r\n\t    this.selection.reset();\r\n\t    this.selection.range();\r\n\t    containerNode = this.selection.containerNode();\r\n\t    if (containerNode[0].nodeType === Node.TEXT_NODE) {\r\n\t      $scales = containerNode.closest('span[style*=\"font-size\"]');\r\n\t    } else {\r\n\t      $scales = containerNode.find('span[style*=\"font-size\"]');\r\n\t    }\r\n\t    $scales.each((function(_this) {\r\n\t      return function(i, n) {\r\n\t        var $span, size;\r\n\t        $span = $(n);\r\n\t        size = n.style.fontSize;\r\n\t        if (/large|x-large|small|x-small/.test(size)) {\r\n\t          return $span.css('fontSize', sizeMap[size]);\r\n\t        } else if (size === 'medium') {\r\n\t          if ($span[0].style.length > 1) {\r\n\t            return $span.css('fontSize', '');\r\n\t          } else {\r\n\t            return $span.replaceWith($span.contents());\r\n\t          }\r\n\t        }\r\n\t      };\r\n\t    })(this));\r\n\t    return this.trigger('valuechanged');\r\n\t},\r\n\r\n\thr : function() {\r\n\t    var $hr, $newBlock, $nextBlock, $rootBlock;\r\n\t    $rootBlock = this.selection.rootNodes().first();\r\n\t    $nextBlock = $rootBlock.next();\r\n\t    if ($nextBlock.length > 0) {\r\n\t      this.selection.save();\r\n\t    } else {\r\n\t      $newBlock = $('<p/>').append(this.util.phBr);\r\n\t    }\r\n\t    $hr = $('<hr/>').insertAfter($rootBlock);\r\n\t    if ($newBlock) {\r\n\t      $newBlock.insertAfter($hr);\r\n\t      this.selection.setRangeAtStartOf($newBlock);\r\n\t    } else {\r\n\t      this.selection.restore();\r\n\t    }\r\n\t    return this.trigger('valuechanged');\r\n\t},\r\n\r\n\tinlineCode : function(active) {\r\n\t    var $code, $contents, range;\r\n\t    range = this.selection.range();\r\n\t    if (this.active) {\r\n\t      range.selectNodeContents(this.node[0]);\r\n\t      this.selection.save(range);\r\n\t      this.node.contents().unwrap();\r\n\t      this.selection.restore();\r\n\t    } else {\r\n\t      $contents = $(range.extractContents());\r\n\t      $code = $(\"<\" + this.htmlTag + \"/>\").append($contents.contents());\r\n\t      range.insertNode($code[0]);\r\n\t      range.selectNodeContents($code[0]);\r\n\t      this.selection.range(range);\r\n\t    }\r\n\t    return this.trigger('valuechanged');\r\n\r\n\t},\r\n\r\n\tindent : function() {\r\n\t    return this.indentation.indent();\r\n\t},\r\n\r\n\tlink : function(active,defaultLinkText) {\r\n\t    var $contents, $link, $newBlock, linkText, range, txtNode;\r\n\t    range = this.selection.range();\r\n\t    if (active) {\r\n\t\t  var node = this.selection.startNodes();\r\n\t      txtNode = document.createTextNode(node.text());\r\n\t      node.replaceWith(txtNode);\r\n\t      range.selectNode(txtNode);\r\n\t    } else {\r\n\t      $contents = $(range.extractContents());\r\n\t      linkText = this.formatter.clearHtml($contents.contents(), false);\r\n\t      $link = $('<a/>', {\r\n\t        href: '',\r\n\t        target: '_blank',\r\n\t        text: linkText || defaultLinkText\r\n\t      });\r\n\t      if (this.selection.blockNodes().length > 0) {\r\n\t        range.insertNode($link[0]);\r\n\t      } else {\r\n\t        $newBlock = $('<p/>').append($link);\r\n\t        range.insertNode($newBlock[0]);\r\n\t      }\r\n\t      range.selectNodeContents($link[0]);\r\n\t    }\r\n\t    this.selection.range(range);\r\n\t    return this.trigger('valuechanged');\r\n\r\n\t},\r\n\r\n\tlist : function(type,param,disableTag) {\r\n      var $list, $rootNodes, anotherType;\r\n      $rootNodes = this.selection.blockNodes();\r\n      anotherType = type === 'ul' ? 'ol' : 'ul';\r\n      this.selection.save();\r\n      $list = null;\r\n      $rootNodes.each((function(_this) {\r\n        return function(i, node) {\r\n          var $node;\r\n          $node = $(node);\r\n          if ($node.is('blockquote, li') || $node.is(disableTag) || _this.util.isDecoratedNode($node) || !noder.contains(document, node)) {\r\n            return;\r\n          }\r\n          if ($node.is(type)) {\r\n            $node.children('li').each(function(i, li) {\r\n              var $childList, $li;\r\n              $li = $(li);\r\n              $childList = $li.children('ul, ol').insertAfter($node);\r\n              return $('<p/>').append($(li).html() || _this.util.phBr).insertBefore($node);\r\n            });\r\n            return $node.remove();\r\n          } else if ($node.is(anotherType)) {\r\n            return $('<' + type + '/>').append($node.contents()).replaceAll($node);\r\n          } else if ($list && $node.prev().is($list)) {\r\n            $('<li/>').append($node.html() || _this.util.phBr).appendTo($list);\r\n            return $node.remove();\r\n          } else {\r\n            $list = $(\"<\" + type + \"><li></li></\" + type + \">\");\r\n            $list.find('li').append($node.html() || _this.util.phBr);\r\n            return $list.replaceAll($node);\r\n          }\r\n        };\r\n      })(this));\r\n      this.selection.restore();\r\n      return this.trigger('valuechanged');\r\n\r\n\t},\r\n\r\n\toutdent : function() {\r\n\t    return this.indentation.indent(true);\r\n\t},\r\n\r\n\t// toggle\r\n\ttitle : function(param,disableTag) {\r\n\t    var $rootNodes;\r\n\t    $rootNodes = this.selection.rootNodes();\r\n\t    this.selection.save();\r\n\t    $rootNodes.each((function(_this) {\r\n\t      return function(i, node) {\r\n\t        var $node;\r\n\t        $node = $(node);\r\n\t        if ($node.is('blockquote') || $node.is(param) || $node.is(disableTag) || _this.util.isDecoratedNode($node)) {\r\n\t          return;\r\n\t        }\r\n\t        return $('<' + param + '/>').append($node.contents()).replaceAll($node);\r\n\t      };\r\n\t    })(this));\r\n\t    this.selection.restore();\r\n\t    return this.trigger('valuechanged');\r\n\r\n\t}\r\n\r\n\r\n\r\n  });\r\n\r\n\tvar commands =  [\r\n\t\t\"bold\", // toggle \r\n\t\t\"insertImage\",\r\n\t\t\"insertorderedlist\",\r\n\t\t\"insertunorderedlist\",\r\n\t\t\"italic\", // toggle\r\n\t\t\"justifyLeft\",\r\n\t\t\"justifyCenter\",\r\n\t\t\"justifyFull\",\r\n\t\t\"justifyRight\",\r\n\t\t\"strikethrough\",\r\n\t\t\"underline\",\r\n\t\t\"undo\"\r\n\t];\r\n\r\n\tcommands.forEach(function(cmd){\r\n\t\tEditor.prototype[cmd] = function() {\r\n\t      document.execCommand(cmd,false,null);\r\n\t      if (!this.util.support.oninput) {\r\n\t        this.trigger('valuechanged');\r\n\t      }\r\n\t      return $(document).trigger('selectionchange');\t\t\t\t\t\r\n\t\t};\r\n\t});\r\n\r\n\r\n\tfunction editable(el,opts) {\r\n\r\n\t\t/*\t\r\n\t\tif (value === undefined) {\r\n   \t\t\treturn node.contentEditable == \"true\"\r\n\t\t} else {\r\n\t\t\tif (!value) {\r\n\t\t\t\tvalue = null;\r\n\t\t\t} else {\r\n\t\t\t\tvalue = \"true\";\r\n\t\t\t}\r\n\t\t\tdatax.attr(node,\"contentEditable\",value);\r\n\t\t}\r\n\t\t*/\r\n\t\treturn new Editor(el,opts);\r\n\t\t\r\n\t};\r\n\r\n\r\n\treturn contents.editable  = editable;\r\n\t\r\n});"]}